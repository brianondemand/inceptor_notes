## What is a reverse shell?

A _reverse shell_ is a script or executable program that makes it possible to gain interactive shell access to a system through an outgoing connection from that system. Malicious hackers often use reverse shells as a means to send commands to a compromised system.

### What is a shell?

A shell is a program that lets users (or other programs) use operating system services. This term is typically used to describe command-line interfaces created for that purpose, such as _cmd.exe_ in Windows, but it can also be used to describe graphical user interfaces (GUIs). The name _shell_ comes from the fact that this is the outer layer of the operating system.

Note that many shells are network-enabled (for example, telnet or SSH) and let users send commands to the operating system remotely. Such software is called _remote shells_.

## How do reverse shells work?

In a typical remote system access scenario, the user has the role of a client, and the target machine acts as a server. The user initiates a remote shell connection while the target system listens for such connections.

In the case of a reverse shell, these roles are switched: the target machine initiates the connection to the user while the user’s computer listens for incoming connections on a specified port.

Reverse shells are often used by attackers because they are not stopped by the most common firewall configurations. The targeted servers usually allow connections only on specific ports, so, for example, a dedicated web server will only accept connections on ports 80 and 443. This makes it impossible to establish a shell listener on the attacked server. Another reason might be that the server is located behind a NAT (network address translation) layer.

On the other hand, firewalls usually do not limit outgoing connections at all, and neither do NATs, so there is nothing to stop an attacker from setting up a server on their own machine and establishing a reverse connection. All the attacker needs is a machine that has a public (routable) IP address and a tool such as `netcat` to create the listener and bind shell access to it.

![][https://www.hackingtutorials.org/wp-content/uploads/2016/11/Netcat-reverse-shell.jpg]



```
Windows Kept Deleting the file: Visit the link to view shells:

https://www.invicti.com/learn/reverse-shell/

https://www.hackingtutorials.org/networking/hacking-netcat-part-2-bind-reverse-shells/

```

## Reverse shell examples

Creating a reverse shell is very simple, and you can use a variety of tools and languages to do it. First, you need a listener on your local machine with a public IP. For example, on a Linux machine, all you need is the following netcat command:

```bash

```


This establishes the listener on TCP port 1337. Let’s assume the user’s machine is available at the IP address 10.10.17.1. Here’s a selection of one-liners that you can execute on the compromised target machine to create a reverse shell connection with the attacker’s machine.

### Bash reverse shell

The simplest method is to use bash, which is available on almost all Linux machines. This script was tested on Ubuntu 18.04, but not all versions of bash support this function:

```bash

```

### PHP reverse shell

If the target machine is a web server that supports PHP, this language will be an excellent choice for a reverse shell:

```php

```


If this does not work, you can try replacing &3 with consecutive file descriptors. Another option for PHP is to download and execute a more complex script developed by `pentestmonkey`.

### Java reverse shell

If the target machine uses Java, try the following simple example:

```java

```

### Perl reverse shell

Perl is another good candidate for a reverse shell on a web server:

```perl

```

### Python reverse shell

Python is commonly used on production systems, so it may be another option for a reverse shell:

```python

```

### Ruby reverse shell

While Ruby is not as common as the other languages, it also makes it possible to create a reverse shell:

```ruby

```

### Netcat reverse shell

Netcat is rarely available on production servers, but if all else fails, the attacker can try the following:

```bash

```

### Powershell reverse shell

On Windows machines, you can even create a reverse shell using Powershell. Here’s an example developed by Nikhil SamratAshok Mittal.

```powershell

```

---

## Netcat Bind Shell

 A bind shell is a shell that binds to a specific port on the target host to listen for incoming connections.

The concept of a bind shell is that the attacker’s machine acts as a client and the victim’s machine acts as a server, which opens a communication port and waits for the client (attacker) to connect to it, and then issues commands to be executed remotely on the victim’s machine.

For this to be possible, the victim machine would have to have a public IP, or the attacker and the remote host would have to be on the same IP subnet, or on subnets that are directly routed to each other without any form of network address translation (NAT) between them. Such a requirement exists because the attacker must be able to direct netcat directly to the machine’s IP address in order to get a response.

![][https://www.hackingtutorials.org/wp-content/uploads/2016/11/Netcat-bind-shell.jpg]

The target host binds a Bash shell to port 4444, than the attack connects to that port using Netcat and gains a root shell on the target.

![][https://www.hackingtutorials.org/wp-content/uploads/2016/11/Netcat-Bind-shell-example.jpg]


---

## Staged vs Stageless Payloads

Staged payloads are like a well-rehearsed performance. They are divided into multiple stages, each serving a specific purpose. The first stage typically establishes a foothold in the target system, while subsequent stages are responsible for executing more complex tasks, such as establishing communication channels or downloading additional malware.

Because this process involves more complex communication, it requires a "Handler" to manage the connection between the attacker and the target. In the world of Metasploit, a popular hacking tool, this is handled by a module called `exploit/multi/handler`.

One common staged payload used in Metasploit is called `windows/meterpreter/reverse_tcp`. This payload is designed for Windows systems and establishes a reverse TCP connection back to the attacker, providing them with remote control over the compromised device.

![][https://wsrv.nl/?url=https://gallery.cyndia.in/1a327d85-37b0-493f-8d00-a7986b6d629a.png&output=webp&q=70&w=828]


A stageless payload is like a complete package. It contains everything needed to establish a connection back to the attacker's system and gain control over the target device. Unlike staged payloads, which are divided into multiple parts, a stageless payload is self-contained.

Because it includes all necessary components in one package, the file size of a stageless payload is usually larger. Additionally, the program itself is more complex compared to staged payloads.

To intercept a stageless payload, you can set up a listener on a raw socket using tools like Netcat, Python, Socat, or similar. These tools enable you to create a receiver that waits for connections from the target device, facilitating interaction with the compromised system once the payload is executed.

![][https://wsrv.nl/?url=https://gallery.cyndia.in/bfbb3b74-4fee-41ad-b11d-8cda87c80fb3.png&output=webp&q=70&w=828]


---

## Brute-Force Credentials with Hydra

![][https://genstoreflows2983.blob.core.windows.net/communityimages/428441i0176ED2255BF9023.png]

### SSH Logins

SSH (Secure Shell) is a commonly used protocol for remote system administration, making it a prime target for attackers. If weak passwords are used, Hydra can crack them efficiently with a dictionary attack.

#### Basic SSH Brute-Force Attack:

hydra -L users.txt -P passwords.txt ssh://`<target-ip>`

- `-L users.txt`: List of possible usernames.
- `-P passwords.txt`: List of passwords to try.
- `ssh://<target-ip>`: Target IP address with SSH service.

#### Slower Brute-Force to Evade Rate-Limiting:

Some systems have countermeasures such as login attempt rate-limiting. To bypass this, you can slow down the attack.

```bash
hydra -L users.txt -P passwords.txt -t 1 -w 5 ssh://<target-ip>
```

- `-t 1`: Limits Hydra to one thread at a time.
- `-w 5`: Introduces a delay of 5 seconds between each attempt.

### HTTP POST Form

Hydra supports attacking web applications that use POST requests for login forms. For example:

```bash
hydra -L users.txt -P passwords.txt http-post-form "/login.php:user=^USER^&password=^PASS^:Invalid Login" -V
```

This command targets a web page with a login form, sending POST requests with specified parameters.

More info:

```
https://www.blackhillsinfosec.com/hacking-with-hydra/
```

----

## Cracking Password Hashes using `Hashcat`

**Check in Practical's section**

